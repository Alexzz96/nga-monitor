# AI 分析提示词优化建议

## 当前问题

1. **角色模糊**："投资行为分析师"定义太宽泛
2. **输出不稳定**：JSON解析偶尔失败
3. **分析深度不足**：缺乏投资逻辑分析
4. **缺少量化指标**：无法直观比较

---

## 建议一：优化系统提示词 (System Prompt)

### 当前
```
你是一位专业的投资行为分析师。
```

### 建议版本
```
你是一位资深的金融市场研究员，专注于分析个人投资者的行为模式、投资逻辑和市场观点。

分析原则：
1. 基于事实发言，不做主观臆测
2. 区分观点表达和实际操作建议
3. 识别用户的决策逻辑而非只看结论
4. 注意用户认知的变化和一致性

输出要求：
- 必须返回有效的 JSON 格式
- 所有字符串字段不能为空
- 数值字段使用整数或字符串
```

---

## 建议二：优化分析提示词 (Analysis Prompt)

### 建议版本
```
请分析以下用户 "{user_name}" 的投资行为和言论特征：

{content}

分析任务：
1. 识别用户的投资方法论（价值/成长/技术/量化等）
2. 判断用户的信息来源和验证能力
3. 评估用户的风险意识和仓位管理能力
4. 分析用户的市场认知层次

请严格按照以下 JSON 格式返回，确保字段完整：
{
    "summary": "50字以内的核心画像",
    "investment_style": "具体投资风格（如：深度价值型/趋势跟踪型/事件驱动型）",
    "methodology": "投资方法论描述（30字以内）",
    "risk_preference": "风险偏好（保守/稳健/平衡/进取/激进）",
    "position_style": "仓位特征（重仓集中/均衡分散/轻仓试错）",
    "focus_areas": ["板块1", "板块2"],
    "key_stocks": ["代码1", "代码2"],
    "sentiment": "当前市场态度（极度乐观/乐观/谨慎乐观/中性/谨慎悲观/悲观/极度悲观）",
    "reasoning_quality": "逻辑质量评分（1-10分）",
    "information_sources": ["信息来源1", "信息来源2"],
    "behavior_patterns": ["行为特征1", "行为特征2"],
    "cognitive_bias": ["可能存在的认知偏差1"],
    "consistency_score": "观点一致性评分（1-10分）",
    "recommendation": "基于以上分析的简要建议（50字以内）"
}

注意：
- 如果某些字段无法判断，填写 "未明确" 或空数组 []
- sentiment 必须从给定选项中选择
- 所有评分使用数字字符串（如 "7"）
```

---

## 建议三：对比分析提示词

### 建议版本
```
请对比分析以下 {user_count} 位用户的投资风格和决策特征：

{content}

对比维度：
1. 投资理念的异同
2. 信息处理方式的差异
3. 风险控制能力的比较
4. 市场敏感度的对比
5. 情绪稳定性的差异

请按以下 JSON 格式输出：
{
    "summary": "整体对比结论（80字以内）",
    "rankings": {
        "risk_management": ["用户1", "用户2"],
        "reasoning_quality": ["用户1", "用户2"],
        "information_breadth": ["用户1", "用户2"]
    },
    "comparisons": [
        {
            "user": "用户名",
            "dominant_trait": "最突出特征",
            "style_summary": "一句话总结风格",
            "strengths": ["优势1", "优势2"],
            "weaknesses": ["不足1", "不足2"],
            "reference_value": "对其他用户的参考价值"
        }
    ],
    "similarities": ["共同点1", "共同点2"],
    "differences": ["核心差异1", "核心差异2"],
    "group_characteristics": "群体特征总结",
    "learning_points": "可互相学习的点"
}
```

---

## 建议四：增加"思考链"提示

如果模型支持（如 Claude 3.5 Sonnet、GPT-4），可以增加 CoT（Chain of Thought）：

```
请按以下步骤分析：

步骤1：提取关键信息
- 列出用户提及的所有股票/基金
- 标记用户表达的观点和预测
- 识别用户的情绪词汇

步骤2：分析投资逻辑
- 用户做决策的依据是什么？
- 这些依据是否合理？
- 用户如何处理不确定性？

步骤3：归纳风格特征
- 基于以上分析，总结用户的稳定行为模式
- 识别用户独特的投资哲学

步骤4：生成结构化报告
- 将以上分析整理成要求的 JSON 格式

请先输出思考过程（用 <thinking> 标签包裹），然后输出最终 JSON。
```

---

## 建议五：不同场景的专用提示词

### 短线交易者专用
```
重点分析：
- 择时能力和信号识别
- 止损纪律和执行力
- 对热点切换的敏感度
- 盈亏比意识
```

### 长线投资者专用
```
重点分析：
- 基本面分析深度
- 企业价值判断能力
- 耐心和持仓定力
- 对估值的理解
```

---

## 建议六：Web 界面默认配置

建议在 `db/models.py` 的 `init_db` 中设置更好的默认提示词：

```python
# 默认系统提示词
default_system_prompt = """你是一位资深的金融市场研究员，专注于分析个人投资者的行为模式。

分析原则：基于事实、区分观点与建议、识别决策逻辑、追踪认知变化。

输出要求：必须返回有效的 JSON 格式，所有字段必填（无则填"未明确"）。"""

# 默认分析提示词
default_analysis_prompt = """请分析用户 "{user_name}" 的投资行为：

{content}

输出 JSON 格式：
{
    "summary": "核心画像",
    "investment_style": "投资风格",
    "risk_preference": "风险偏好",
    "focus_areas": [],
    "key_stocks": [],
    "sentiment": "情绪倾向",
    "characteristics": [],
    "recommendation": "建议"
}"""
```

---

## 实施建议

1. **先测试再推广**：用 3-5 个真实用户的回复测试新提示词的效果
2. **对比验证**：新老提示词同时运行，对比输出质量
3. **迭代优化**：根据实际使用效果持续调整
4. **用户反馈**：收集用户对分析准确性的反馈

需要我直接更新代码中的默认提示词吗？
